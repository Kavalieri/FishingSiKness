name: release-please

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  release:
    runs-on: ubuntu-latest
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}
    steps:
      - name: ðŸ› ï¸ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸš€ Run Release Please
        id: release
        uses: googleapis/release-please-action@v4
        with:
          release-type: simple
          token: ${{ secrets.GITHUB_TOKEN }}
          config-file: .github/release-please-config.json
          manifest-file: .release-please-manifest.json

      - name: ðŸŽ® Update Release with Enhanced Description
        if: steps.release.outputs.release_created
        run: |
          # Crear descripciÃ³n mejorada con cabecera informativa
          cat > release_description.md << 'EOF'
          <div align="center">

          <img src="https://raw.githubusercontent.com/Kavalieri/FishingSiKness/main/project/icon.svg" alt="FishingSiKness Logo" width="300" />

          # ðŸŽ£ FishingSiKness ${{ steps.release.outputs.tag_name }}

          **ðŸ¤– Juego de pesca experimental desarrollado completamente con IA**

          ![Alpha](https://img.shields.io/badge/Status-Alpha-orange?style=for-the-badge)
          ![Platform](https://img.shields.io/badge/Platform-Windows%20|%20Android%20|%20Web-lightgrey?style=for-the-badge)

          ---

          </div>

          ## ðŸŽ® **JUGAR AHORA**

          ### ðŸŒ **VersiÃ³n Web (Recomendada)**
          **â–¶ï¸ [https://fishingsikness.vercel.app/](https://fishingsikness.vercel.app/)**
          - âœ… **Sin instalaciÃ³n** - Juega inmediatamente en tu navegador
          - ðŸš€ **Siempre actualizada** - Deploy automÃ¡tico con cada release
          - ðŸ“± **Compatible mÃ³vil** - Funciona en smartphones y tablets

          ### ðŸ“¥ **Descargas Nativas**
          - ðŸ–¥ï¸ **Windows**: Ejecutable standalone (descarga abajo)
          - ðŸ“± **Android**: APK para instalaciÃ³n directa (descarga abajo)

          ---

          ## âš ï¸ **ESTADO DE DESARROLLO**

          **Esta es una versiÃ³n ALPHA experimental** desarrollada mediante agentes de IA. El juego estÃ¡ en desarrollo activo con las siguientes caracterÃ­sticas:

          - ðŸ”¬ **Funcionalidades bÃ¡sicas**: Sistema de pesca, inventario y guardado implementados
          - ðŸŽ¯ **Arquitectura data-driven**: Todo el contenido definido mediante recursos `.tres`
          - ðŸ› ï¸ **Desarrollo continuo**: Updates frecuentes con nuevas mecÃ¡nicas
          - ðŸ› **Bugs esperados**: Como toda versiÃ³n alpha, puede tener problemas conocidos

          ---

          ## ðŸš€ **CHANGELOG**

          EOF

          # Obtener el body actual de la release y anexar
          CURRENT_BODY=$(gh release view ${{ steps.release.outputs.tag_name }} --json body -q .body)

          # Combinar nueva descripciÃ³n con changelog existente
          cat release_description.md > final_description.md
          echo "$CURRENT_BODY" >> final_description.md

          # Actualizar la release con la nueva descripciÃ³n
          gh release edit ${{ steps.release.outputs.tag_name }} --notes-file final_description.md --prerelease
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
